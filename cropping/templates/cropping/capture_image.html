<!DOCTYPE html>
<html>
  <head>
    <title>Capture Image</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      #image-container {
        position: relative;
        width: 500px;
        height: 500px;
        border: 1px solid black;
        overflow: hidden;
      }

      #crop-box {
        position: absolute;
        top: 0;
        left: 0;
        width: 0;
        height: 0;
        border: 2px solid red;
        pointer-events: none;
      }

      #crop-btn {
        margin-right: 10px;
      }
    </style>
  </head>
  <body>
    <h1>Capture Image</h1>

    <div id="image-container">
      <img src="example-image.jpg" alt="Example Image" id="image">
      <div id="crop-box"></div>
    </div>

    <button id="crop-btn">Crop</button>
    <button id="save-btn">Save</button>

    <script>
      const imageContainer = document.querySelector('#image-container');
      const image = document.querySelector('#image');
      const cropBox = document.querySelector('#crop-box');
      const cropBtn = document.querySelector('#crop-btn');
      const saveBtn = document.querySelector('#save-btn');

      let isDragging = false;
      let startX, startY, currentX, currentY;

      function showCropBox(x, y) {
        cropBox.style.left = `${x}px`;
        cropBox.style.top = `${y}px`;
        cropBox.style.width = '0';
        cropBox.style.height = '0';
        cropBox.style.display = 'block';
      }

      function updateCropBox(x, y) {
        const width = x - startX;
        const height = y - startY;

        cropBox.style.width = `${width}px`;
        cropBox.style.height = `${height}px`;
      }

      function hideCropBox() {
        cropBox.style.display = 'none';
      }

      function cropImage() {
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');

        canvas.width = cropBox.clientWidth;
        canvas.height = cropBox.clientHeight;

        context.drawImage(
          image,
          cropBox.offsetLeft - image.offsetLeft,
          cropBox.offsetTop - image.offsetTop,
          cropBox.clientWidth,
          cropBox.clientHeight,
          0,
          0,
          canvas.width,
          canvas.height
        );

        const dataURL = canvas.toDataURL('image/jpeg', 1.0);

        const link = document.createElement('a');
        link.download = 'cropped-image.jpg';
        link.href = dataURL;
        link.click();
      }

      cropBtn.addEventListener('click', () => {
        isDragging = true;
      });

      imageContainer.addEventListener('mousedown', (event) => {
        if (isDragging) {
          startX = event.clientX - imageContainer.offsetLeft;
          startY = event.clientY - imageContainer.offsetTop;

          showCropBox(startX, startY);
        }
      });

      imageContainer.addEventListener('mousemove', (event) => {
        if (isDragging) {
          currentX = event.clientX - imageContainer.offsetLeft;
          currentY = event.clientY - imageContainer.offsetTop;

          updateCropBox(currentX, currentY);
        }
      });

      imageContainer.addEventListener('mouseup', () => {
        if (isDragging) {
          isDragging = false;
          hideCropBox();
        }
      });

      saveBtn.addEventListener('click', () => {
        cropImage();
      });
    </script>
  </body>
</html>